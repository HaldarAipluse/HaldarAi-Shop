<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="HaldarAi Shop is your one-stop online destination for exclusive products. Browse, bookmark, and buy with ease.">
    
    <!-- Best Practices: Added Content Security Policy to enhance security -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' https://www.gstatic.com; 
        style-src 'self' 'unsafe-inline'; 
        img-src 'self' https://i.ibb.co data:; 
        connect-src 'self' wss://*.firebasedatabase.app https://*.firebaseapp.com;
        font-src 'self';
        frame-src 'self';">

    <title>HaldarAi Shop • Online Shop</title>
    <style>
        /* --- আপনার সমস্ত CSS কোড এখানে অপরিবর্তিত থাকবে --- */
        :root{--bg-color:#f4f4f9;--text-color:#0a0a1a;--header-bg:rgba(244,244,249,.7);--primary-glow:#007bff;--secondary-glow:#6f42c1;--accent-glow:#28a745;--glass-bg:rgba(255,255,255,.6);--glass-border:rgba(0,0,0,.1);--card-bg-1:#fff;--card-bg-2:rgba(0,0,0,.02);--shadow-color-light:rgba(0,0,0,.1);--shadow-color-heavy:rgba(0,0,0,.08);--input-bg:rgba(0,0,0,.05);--btn-secondary-bg:#e9ecef;--btn-secondary-text:#343a40;--btn-secondary-hover-bg:#ced4da;--bookmark-color:#aaa;--bookmarked-color:#dc3545;--error-color:#dc3545}body.dark-mode{--bg-color:#0a0a1a;--text-color:#f0f0f0;--header-bg:rgba(10,10,30,.7);--primary-glow:#00ffff;--secondary-glow:#9400d3;--accent-glow:#39ff14;--glass-bg:rgba(10,10,30,.5);--glass-border:rgba(255,255,255,.2);--card-bg-1:rgba(255,255,255,.05);--card-bg-2:rgba(0,255,255,.05);--shadow-color-light:rgba(0,0,0,.37);--shadow-color-heavy:rgba(0,0,0,.3);--input-bg:rgba(0,0,0,.3);--btn-secondary-bg:#555;--btn-secondary-text:#fff;--btn-secondary-hover-bg:#777;--bookmark-color:#f0f0f0;--bookmarked-color:#ff3b30;--error-color:#ff3b30}*{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;background-color:var(--bg-color);color:var(--text-color);line-height:1.6;overflow-x:hidden;transition:background-color .3s ease,color .3s ease}.container{padding:1rem;padding-top:80px;padding-bottom:80px}.hidden{display:none!important}.glass-card{background:var(--glass-bg);-webkit-backdrop-filter:blur(15px);backdrop-filter:blur(15px);border-radius:20px;border:1px solid var(--glass-border);padding:2rem;box-shadow:0 8px 32px 0 var(--shadow-color-light)}.glow-btn{padding:12px 25px;border:none;border-radius:10px;color:#fff;font-weight:700;cursor:pointer;background:linear-gradient(45deg,var(--primary-glow),var(--secondary-glow));box-shadow:0 4px 15px #007bff33;transition:all .3s ease}.glow-btn:hover{transform:scale(1.05);box-shadow:0 6px 25px #007bff66}.glow-input{width:100%;padding:12px 15px;margin-bottom:1rem;background:var(--input-bg);border:1px solid var(--glass-border);border-radius:10px;color:var(--text-color);font-size:1rem;transition:all .3s ease}.glow-input:focus{outline:0;border-color:var(--primary-glow);box-shadow:0 0 10px #007bff55}#main-header{position:fixed;top:0;left:0;width:100%;z-index:1000;display:flex;justify-content:space-between;align-items:center;padding:.8rem 1rem;background:var(--header-bg);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-bottom:1px solid var(--glass-border)}#header-brand{display:flex;align-items:center;gap:15px}#brand-logo{max-height:40px;border-radius:50%}#brand-name{font-size:1.5rem;font-weight:700}#hamburger-btn,#theme-toggle-btn{background:0 0;border:none;cursor:pointer;color:var(--text-color);padding:5px}#hamburger-btn .line{width:30px;height:3px;background-color:var(--text-color);margin:6px 0;transition:.4s}#theme-toggle-btn svg{width:24px;height:24px}#slide-menu{position:fixed;top:0;left:-100%;width:80%;max-width:300px;height:100%;background:var(--bg-color);z-index:1001;transition:left .5s ease;display:flex;flex-direction:column;border-right:1px solid var(--glass-border)}#slide-menu.active{left:0}#slide-menu a{padding:15px 25px;color:var(--text-color);text-decoration:none;font-size:1.2rem;display:block;transition:all .3s ease}#slide-menu a:hover{background:var(--glass-bg);color:var(--primary-glow);padding-left:30px}#close-menu-btn{position:absolute;top:10px;right:15px;background:0 0;border:none;color:var(--text-color);font-size:2.5rem;font-weight:300;cursor:pointer;line-height:1}#menu-user-info.menu-user-profile{margin-top:40px;display:flex;flex-direction:column;align-items:center;text-align:center;padding:20px 15px;border-bottom:1px solid var(--glass-border)}.menu-user-profile-img{width:80px;height:80px;border-radius:50%;margin-bottom:10px;object-fit:cover;background-color:var(--glass-bg);border:2px solid var(--glass-border)}.menu-user-profile-name{font-weight:700;font-size:1.1rem}#menu-user-info:not(.menu-user-profile){padding:15px 25px;border-bottom:1px solid var(--glass-border)}#banner-carousel-container{width:100%;margin-bottom:2rem;border-radius:20px;overflow:hidden;position:relative;box-shadow:0 8px 32px 0 var(--shadow-color-light)}#banner-carousel{display:flex;transition:transform .5s ease-in-out}.banner-slide{min-width:100%;position:relative}.banner-slide img{width:100%;display:block;aspect-ratio:16 / 9;object-fit:cover}#banner-dots{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:8px}.banner-dot{width:8px;height:8px;border-radius:50%;background-color:rgba(255,255,255,.5);cursor:pointer;transition:background-color .3s ease;border:none;padding:0}.banner-dot.active{background-color:var(--primary-glow)}#search-container{margin-bottom:2rem}#search-bar{width:100%;padding:15px 20px;font-size:1.1rem;background:var(--card-bg-1);border:1px solid var(--glass-border);border-radius:50px;color:var(--text-color);transition:all .4s ease}#search-bar:focus{box-shadow:0 0 15px #007bff55;border-color:var(--primary-glow)}#product-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.product-card{border-radius:24px;padding:1rem;position:relative;transition:transform .3s ease,box-shadow .3s ease;cursor:pointer;border:1px solid var(--glass-border);box-shadow:0 4px 6px var(--shadow-color-light);background-color:var(--card-bg-1)}.product-card:hover{transform:translateY(-5px);box-shadow:0 12px 20px var(--shadow-color-heavy);border-color:var(--primary-glow)}.product-card img{width:100%;height:120px;object-fit:contain;margin-bottom:1rem}.product-card .bookmark-icon{position:absolute;top:15px;right:15px;background:0 0;border:none;color:var(--bookmark-color);cursor:pointer;z-index:2}.product-card .bookmark-icon svg{width:24px;height:24px}.product-card .bookmark-icon.bookmarked{color:var(--bookmarked-color)}.product-card-info h3{font-size:1rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.product-card-footer{display:flex;justify-content:space-between;align-items:center;margin-top:.5rem}.product-card-footer .price{font-size:1.1rem;font-weight:700;color:var(--accent-glow);text-shadow:none}.product-card-footer .buy-btn{padding:6px 16px;border-radius:20px;background:var(--btn-secondary-bg);color:var(--btn-secondary-text);border:none;cursor:pointer;font-size:.9rem;transition:background .3s ease;font-weight:600}.product-card-footer .buy-btn:hover{background:var(--btn-secondary-hover-bg)}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:2000;display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:all .4s ease}.modal-overlay.active{opacity:1;visibility:visible}.modal-content{width:90%;max-width:500px;max-height:90vh;overflow-y:auto;transform:scale(.9);transition:transform .4s ease}.modal-overlay.active .modal-content{transform:scale(1)}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}#product-detail-img-container{background:var(--card-bg-2);border-radius:20px;padding:1rem;margin-bottom:1.5rem}#product-detail-img{display:block;width:100%;height:250px;object-fit:contain}#product-detail-desc{opacity:.8;margin-bottom:1.5rem;font-size:.95rem}#product-detail-footer{display:flex;justify-content:space-between;align-items:center;margin-top:1.5rem}#product-detail-prices .original{text-decoration:line-through;opacity:.6;display:block;font-size:1rem}#product-detail-prices .discount{color:var(--primary-glow);font-weight:700;font-size:2rem;text-shadow:none}#buy-now-btn{background:linear-gradient(45deg,#ff416c,#ff4b2b);box-shadow:0 4px 15px #ff416c55}.content-view{animation:fadeIn .5s ease}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}#profile-image-preview{width:120px;height:120px;border-radius:50%;border:3px solid var(--primary-glow);margin:0 auto 1.5rem;background-size:cover;background-position:center;background-color:var(--glass-bg)}#auth-links{margin-top:1rem}#auth-links a{background:0 0;border:none;color:var(--primary-glow);cursor:pointer;text-decoration:underline;margin:0 5px;font-size:.9rem}#auth-message{color:var(--accent-glow);margin-bottom:1rem;font-weight:700}.modal-close-btn.cancel-btn{background:var(--btn-secondary-bg)!important;color:var(--btn-secondary-text)!important;box-shadow:none!important}.modal-close-btn.cancel-btn:hover{background:var(--btn-secondary-hover-bg)!important}.social-links{display:flex;gap:1.5rem;margin-top:1.5rem;justify-content:center;flex-wrap:wrap}.social-link{display:flex;align-items:center;gap:8px;color:var(--text-color);text-decoration:none;transition:color .3s ease;opacity:.8}.social-link:hover{color:var(--primary-glow);opacity:1}.social-link svg{width:28px;height:28px}#bottom-bar{position:fixed;bottom:0;left:0;width:100%;background:var(--header-bg);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-top:1px solid var(--glass-border);display:flex;justify-content:space-around;padding:.5rem 0;z-index:999}.bottom-btn{background:0 0;border:none;color:var(--text-color);cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:.7rem;opacity:.8;transition:all .3s ease}.bottom-btn:hover{opacity:1;color:var(--primary-glow)}.bottom-btn svg{width:24px;height:24px}
    </style>
</head>
<body>

    <header id="main-header">
        <button id="hamburger-btn" aria-label="Open menu"><div class="line"></div><div class="line"></div><div class="line"></div></button>
        <!-- Performance: Added width, height to prevent CLS. Added decoding=async. -->
        <div id="header-brand"><img id="brand-logo" src="https://i.ibb.co/BKvqBt5N/O.png" alt="HaldarAi Shop Logo" width="40" height="40" decoding="async"><span id="brand-name">HaldarAi Shop</span></div>
        <button id="theme-toggle-btn" title="Toggle theme" aria-label="Toggle color theme">
            <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 008.252-4.498z" /></svg>
            <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" /></svg>
        </button>
    </header>

    <nav id="slide-menu">
        <button id="close-menu-btn" aria-label="Close menu">&times;</button>
        <div id="menu-user-info"></div>
        <div id="menu-links"></div>
    </nav>
    
    <main class="container">
        <!-- Views -->
        <div id="products-view" class="content-view">
            <div id="banner-carousel-container" class="hidden">
                <div id="banner-carousel"></div>
                <div id="banner-dots"></div>
            </div>
            <div id="search-container"><input type="text" id="search-bar" class="glow-input" placeholder="Search products..."></div>
            <div id="product-grid"></div>
        </div>
        <div id="bookmarks-view" class="content-view hidden"><h2>My Bookmarks</h2><div id="bookmark-grid" class="product-grid-style"></div></div>
        <div id="purchase-history-view" class="content-view hidden"><h2>My Purchase History</h2><div id="purchase-list"></div></div>
        <div id="contact-us-view" class="content-view hidden glass-card">
            <h2>Contact Us</h2>
            <div id="contact-info">
                <p><strong>Brand:</strong> HaldarAi Shop</p><p><strong>Operator:</strong> E-commerce</p><p><strong>Address:</strong> N/A</p>
                <p><strong>Location:</strong> Kolkata / West Bengal / 712303</p><p><strong>Email:</strong> officialhaldarai@gmail.com</p>
                <p><strong>Phone:</strong> 8637856826</p>
            </div>
            <div class="social-links">
                <a href="https://x.com/haldariq" target="_blank" class="social-link" rel="noopener noreferrer">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
                    <span>X (Twitter)</span>
                </a>
                <a href="https://youtube.com/@haldariq" target="_blank" class="social-link" rel="noopener noreferrer">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,12.89 21.94,13.78 21.84,14.67C21.78,15.56 21.69,16.25 21.56,16.72C21.31,17.7 20.73,18.44 19.96,18.9C19.37,19.24 18.59,19.42 17.5,19.5C15.55,19.58 13.53,19.64 12,19.64C10.47,19.64 8.45,19.58 6.5,19.5C5.41,19.42 4.63,19.24 4.04,18.9C3.27,18.44 2.69,17.7 2.44,16.72C2.31,16.25 2.22,15.56 2.16,14.67C2.09,13.78 2.06,12.89 2.06,12L2,11.16C2,10.56 2.03,9.87 2.09,9.07C2.16,8.27 2.25,7.64 2.38,7.17C2.63,6.2 3.21,5.46 3.98,5C4.57,4.66 5.35,4.48 6.44,4.4C8.39,4.32 10.41,4.26 12,4.26C13.53,4.26 15.55,4.32 17.5,4.4C18.59,4.48 19.37,4.66 19.96,5C20.73,5.46 21.31,6.2 21.56,7.17Z"></path></svg>
                    <span>YouTube</span>
                </a>
            </div>
        </div>
        <div id="profile-view" class="content-view hidden glass-card">
            <h2>My Profile</h2>
            <form id="profile-form">
                <div id="profile-image-preview"></div>
                <label for="profile-image-url">Profile Image URL</label><input type="url" id="profile-image-url" class="glow-input" placeholder="https://example.com/image.png">
                <label for="profile-name">Name</label><input type="text" id="profile-name" class="glow-input" placeholder="Your full name">
                <label for="profile-dob">Date of Birth</label><input type="date" id="profile-dob" class="glow-input">
                <label for="profile-address">Address</label><textarea id="profile-address" class="glow-input" placeholder="Your address" rows="3"></textarea>
                <label for="profile-phone">Contact Number</label><input type="tel" id="profile-phone" class="glow-input" placeholder="Your phone number">
                <button type="submit" class="glow-btn" style="width: 100%; margin-top: 1rem;">Save Changes</button>
            </form>
        </div>
    </main>

    <footer id="bottom-bar">
        <button class="bottom-btn" data-policy="refund">Refund</button><button class="bottom-btn" data-policy="terms">T&C</button>
        <button class="bottom-btn" data-policy="delivery">Delivery</button><button class="bottom-btn" data-policy="privacy">Privacy</button>
        <button class="bottom-btn" id="contact-link-footer">Contact</button>
    </footer>

    <!-- MODALS -->
    <div id="product-detail-modal" class="modal-overlay"><div class="modal-content glass-card">
        <div class="modal-header"><h2 id="product-detail-title"></h2><button class="modal-close-btn" aria-label="Close product details" style="background:none; border:none; color:var(--text-color); font-size:2rem; cursor:pointer;">&times;</button></div>
        <!-- Performance: Added explicit width/height to modal image to prevent CLS -->
        <div id="product-detail-img-container"><img id="product-detail-img" src="" alt="Product Image" width="500" height="250" decoding="async"></div>
        <p id="product-detail-desc"></p>
        <div id="product-detail-footer">
            <div id="product-detail-prices"><span class="original" id="product-detail-original-price"></span><span class="discount" id="product-detail-discount-price"></span></div>
            <button id="buy-now-btn" class="glow-btn">Buy Now</button>
        </div>
    </div></div>
    <!-- ... Other modals remain unchanged ... -->
    <div id="buy-now-modal" class="modal-overlay"><div class="modal-content glass-card"><h2>Your Details</h2><form id="user-info-form"><input type="text" id="user-name" class="glow-input" placeholder="Full Name" required><input type="email" id="user-email" class="glow-input" placeholder="Email Address" required><input type="tel" id="user-phone" class="glow-input" placeholder="Phone Number" required><div style="display:flex;gap:1rem;margin-top:1rem"><button type="submit" class="glow-btn">Proceed to Pay</button><button type="button" class="modal-close-btn glow-btn cancel-btn">Cancel</button></div></form></div></div>
    <div id="auth-modal" class="modal-overlay"><div class="modal-content glass-card"><h2 id="auth-title">Login</h2><form id="auth-form"><div id="auth-message" class="hidden"></div><p id="auth-error" style="color:var(--error-color);margin-bottom:1rem"></p><div id="auth-email-group"><input type="email" id="auth-email" class="glow-input" placeholder="Email" required></div><div id="auth-password-group"><input type="password" id="auth-password" class="glow-input" placeholder="Password"></div><div id="auth-confirm-password-group" class="hidden"><input type="password" id="auth-confirm-password" class="glow-input" placeholder="Confirm Password"></div><button type="submit" id="auth-action-btn" class="glow-btn" style="width:100%">Login</button></form><div id="auth-links" style="text-align:center"></div><button type="button" class="modal-close-btn glow-btn cancel-btn" style="margin-top:1rem;width:100%">Cancel</button></div></div>
    <div id="policy-modal" class="modal-overlay"><div class="modal-content glass-card"><div class="modal-header"><h2 id="policy-title"></h2><button class="modal-close-btn" aria-label="Close policy" style="background:none;border:none;font-size:2rem;color:var(--text-color)">&times;</button></div><div id="policy-content" style="white-space:pre-wrap;opacity:.9"></div></div></div>

    <script type="module" defer>
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getDatabase, ref, onValue, set, get, push } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        // --- Your existing JavaScript logic follows ---
        const firebaseConfig={apiKey:"AIzaSyBF8WGFStX62SCFqhMzqcvIFI0LZTJfd30",authDomain:"social-media-420.firebaseapp.com",databaseURL:"https://social-media-420-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"social-media-420",storageBucket:"social-media-420.firebasestorage.app",messagingSenderId:"137093270524",appId:"1:137093270524:web:2847379ede160b6c73c079",measurementId:"G-G842MWTJKD"};
        const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getDatabase(app);
        let allProducts={},currentUser=null,currentProduct=null,authMode='login',currentSlide=0,slideInterval;
        const hamburgerBtn=document.getElementById('hamburger-btn'),slideMenu=document.getElementById('slide-menu'),productGrid=document.getElementById('product-grid'),views=document.querySelectorAll('.content-view'),themeToggleBtn=document.getElementById('theme-toggle-btn'),sunIcon=document.getElementById('sun-icon'),moonIcon=document.getElementById('moon-icon'),closeMenuBtn=document.getElementById('close-menu-btn'),bannerContainer=document.getElementById('banner-carousel-container'),bannerCarousel=document.getElementById('banner-carousel'),bannerDots=document.getElementById('banner-dots');
        function applyTheme(e){"dark"===e?(document.body.classList.add('dark-mode'),moonIcon.classList.add('hidden'),sunIcon.classList.remove('hidden')):(document.body.classList.remove('dark-mode'),moonIcon.classList.remove('hidden'),sunIcon.classList.add('hidden'))}
        themeToggleBtn.addEventListener('click',()=>{const e=document.body.classList.contains('dark-mode')?"light":"dark";localStorage.setItem('theme',e),applyTheme(e)}),document.addEventListener('DOMContentLoaded',()=>{applyTheme(localStorage.getItem('theme')||'light'),fetchBanners(),fetchProducts(),setupEventListeners()}),onAuthStateChanged(auth,e=>{currentUser=e,updateMenu(),Object.keys(allProducts).length>0&&renderProducts(allProducts)});
        async function updateMenu(){const e=document.getElementById('menu-user-info'),t=document.getElementById('menu-links');if(e.className="",currentUser){e.className='menu-user-profile';const a=await get(ref(db,`users/${currentUser.uid}/profile`));let n=currentUser.email.split('@')[0],s='https://i.ibb.co/6154V2d/user.png';
        // Performance: Added width, height, decoding to profile image
        a.exists()){const e=a.val();n=e.name||n,s=e.imageUrl||s}e.innerHTML=`<img src="${s}" alt="Profile" class="menu-user-profile-img" width="80" height="80" decoding="async"><p class="menu-user-profile-name">${n}</p>`,t.innerHTML='<a href="#" data-view="products-view">Products</a><a href="#" data-view="profile-view">My Profile</a><a href="#" data-view="purchase-history-view">Purchase History</a><a href="#" data-view="bookmarks-view">Bookmarks</a><a href="#" data-view="contact-us-view">Contact Us</a><a href="#" id="logout-link">Logout</a>',document.getElementById('logout-link').addEventListener('click',e=>{e.preventDefault(),signOut(auth),switchView('products-view'),closeMenu()})}else e.innerHTML='<p>Guest</p>',t.innerHTML='<a href="#" data-view="products-view">Products</a><a href="#" class="login-prompt-link" data-view="bookmarks-view">Bookmarks</a><a href="#" data-view="contact-us-view">Contact Us</a><a href="#" id="login-signup-link">Login/Signup</a>',document.getElementById('login-signup-link').addEventListener('click',e=>{e.preventDefault(),openAuthModal(),closeMenu()}),document.querySelectorAll('.login-prompt-link').forEach(e=>e.addEventListener('click',e=>{e.preventDefault(),currentUser||(alert('Please log in.'),openAuthModal())}));document.querySelectorAll('#menu-links a[data-view]').forEach(e=>{e.addEventListener('click',e=>{e.preventDefault();const t=e.target.getAttribute('data-view');['bookmarks-view','purchase-history-view','profile-view'].includes(t)&&!currentUser?(alert('Please log in.'),openAuthModal()):(switchView(t),closeMenu())})})}
        function fetchBanners(){onValue(ref(db,'banners'),e=>{renderBanners(e.val())})}
        function renderBanners(e){if(!e||0===Object.keys(e).length)return void bannerContainer.classList.add('hidden');bannerContainer.classList.remove('hidden'),bannerCarousel.innerHTML='',bannerDots.innerHTML='',clearInterval(slideInterval);const t=Object.values(e);t.forEach((e,a)=>{const n=document.createElement('div');n.className='banner-slide';
        // Performance: Added decoding=async to banner images. Width/height is handled by aspect-ratio CSS.
        const s=`<img src="${e.imageUrl}" alt="Banner ${a+1}" decoding="async">`;n.innerHTML=e.linkUrl?`<a href="${e.linkUrl}" target="_blank" rel="noopener noreferrer">${s}</a>`:s,bannerCarousel.appendChild(n);
        // Accessibility: Changed dots from <span> to <button> for screen readers
        const i=document.createElement('button');i.className='banner-dot',i.setAttribute('aria-label',`Go to slide ${a+1}`),i.addEventListener('click',()=>showSlide(a)),bannerDots.appendChild(i)}),currentSlide=0,showSlide(currentSlide),slideInterval=setInterval(()=>{currentSlide=(currentSlide+1)%t.length,showSlide(currentSlide)},4e3)}
        function showSlide(e){const t=document.querySelectorAll('.banner-slide'),a=document.querySelectorAll('.banner-dot');e>=t.length&&(e=0),e<0&&(e=t.length-1),bannerCarousel.style.transform=`translateX(-${100*e}%)`,a.forEach(e=>e.classList.remove('active')),a[e]&&a[e].classList.add('active'),currentSlide=e}
        function fetchProducts(){onValue(ref(db,'products'),e=>{allProducts=e.val()||{},renderProducts(allProducts)})}
        async function renderProducts(e){productGrid.innerHTML='';let t={};if(currentUser){const e=await get(ref(db,`users/${currentUser.uid}/bookmarks`));e.exists()&&(t=e.val())}for(const[a,n]of Object.entries(e)){const s=document.createElement('div');s.className='product-card',s.dataset.id=a,s.dataset.title=n.title.toLowerCase();const i=t[a];
        // Performance & Accessibility: Added width, height, decoding to product images and aria-label to bookmark button.
        s.innerHTML=`<button class="bookmark-icon ${i?"bookmarked":""}" aria-label="Toggle bookmark"><svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg></button><img src="${n.imageUrl}" alt="${n.title}" width="120" height="120" decoding="async"><div class="product-card-info"><h3>${n.title}</h3></div><div class="product-card-footer"><span class="price">₹${n.discountPrice}</span><button class="buy-btn">Buy</button></div>`,s.querySelector('.buy-btn').addEventListener('click',e=>{e.stopPropagation(),openProductDetail(a,n)}),s.addEventListener('click',()=>openProductDetail(a,n)),s.querySelector('.bookmark-icon').addEventListener('click',e=>{e.stopPropagation(),toggleBookmark(a)}),productGrid.appendChild(s)}}
        function setupEventListeners(){hamburgerBtn.addEventListener('click',()=>slideMenu.classList.add('active')),closeMenuBtn.addEventListener('click',closeMenu),document.getElementById('search-bar').addEventListener('input',filterProducts),document.querySelectorAll('.modal-close-btn').forEach(e=>e.addEventListener('click',closeModal)),document.querySelectorAll('.modal-overlay').forEach(e=>e.addEventListener('click',t=>{t.target===e&&closeModal()})),document.getElementById('buy-now-btn').addEventListener('click',()=>openBuyNowModal()),document.getElementById('user-info-form').addEventListener('submit',handlePurchase),document.getElementById('profile-form').addEventListener('submit',handleProfileSave),document.getElementById('auth-form').addEventListener('submit',handleAuthAction),document.querySelectorAll('.bottom-btn').forEach(e=>{e.addEventListener('click',t=>{t.currentTarget.dataset.policy?openPolicyModal(t.currentTarget.dataset.policy):"contact-link-footer"===t.currentTarget.id&&switchView('contact-us-view')})})}
        function switchView(e){views.forEach(e=>e.classList.add('hidden'));const t=document.getElementById(e);t&&(t.classList.remove('hidden'),"bookmarks-view"===e&&loadBookmarks(),"purchase-history-view"===e&&loadPurchaseHistory(),"profile-view"===e&&loadUserProfile())}
        function filterProducts(e){const t=e.target.value.toLowerCase();document.querySelectorAll('.product-card').forEach(e=>{e.style.display=e.dataset.title.includes(t)?"":"none"})}
        function closeMenu(){slideMenu.classList.remove('active')}
        function openModal(e){document.getElementById(e).classList.add('active')}
        function closeModal(){document.querySelectorAll('.modal-overlay').forEach(e=>e.classList.remove('active'))}
        function openProductDetail(e,t){currentProduct={id:e,...t},document.getElementById('product-detail-title').textContent=t.title,document.getElementById('product-detail-img').src=t.imageUrl,document.getElementById('product-detail-desc').textContent=t.description,document.getElementById('product-detail-original-price').textContent=`₹${t.originalPrice}`,document.getElementById('product-detail-discount-price').textContent=`₹${t.discountPrice}`,openModal('product-detail-modal')}
        function openBuyNowModal(){currentProduct&&(currentUser?(closeModal(),openModal('buy-now-modal')):(alert('Please log in.'),openAuthModal()))}
        async function handlePurchase(e){e.preventDefault();const t={name:document.getElementById('user-name').value,email:document.getElementById('user-email').value,phone:document.getElementById('user-phone').value},a={productId:currentProduct.id,productSnapshot:{title:currentProduct.title,price:currentProduct.discountPrice},userInput:t,createdAt:(new Date).toISOString()};try{const e=push(ref(db,'orders'));await set(e,a),currentUser&&await set(ref(db,`users/${currentUser.uid}/purchases/${e.key}`),!0),alert('Redirecting to payment...'),window.location.href=currentProduct.paymentLink}catch(e){alert('Error: '+e.message)}}
        async function toggleBookmark(e){if(!currentUser)return alert('Please log in.'),void openAuthModal();if(!e)return;const t=ref(db,`users/${currentUser.uid}/bookmarks/${e}`),a=document.querySelector(`.product-card[data-id="${e}"] .bookmark-icon`);(await get(t)).exists()?(await set(t,null),a&&a.classList.remove('bookmarked')):(await set(t,!0),a&&a.classList.add('bookmarked'))}
        async function loadBookmarks(){if(!currentUser)return;const e=document.getElementById('bookmark-grid');e.innerHTML='<p>Loading...</p>';const t=await get(ref(db,`users/${currentUser.uid}/bookmarks`));if(!t.exists())return void(e.innerHTML='<p>No bookmarked items.</p>');e.innerHTML='';const a=Object.keys(t.val());for(const t of a){const a=await get(ref(db,`products/${t}`));if(a.exists()){const n=a.val(),s=document.createElement('div');s.className='product-card',s.innerHTML=`<img src="${n.imageUrl}" width="120" height="120" decoding="async"><h3>${n.title}</h3><div class="product-card-footer"><span class="price">₹${n.discountPrice}</span><button class="buy-btn">View</button></div>`,s.addEventListener('click',()=>openProductDetail(t,n)),e.appendChild(s)}}}
        async function loadPurchaseHistory(){if(!currentUser)return;const e=document.getElementById('purchase-list');e.innerHTML='<p>Loading...</p>';const t=await get(ref(db,`users/${currentUser.uid}/purchases`));if(!t.exists())return void(e.innerHTML='<p>No purchase history.</p>');e.innerHTML='';const a=Object.keys(t.val());for(const t of a.reverse()){const a=await get(ref(db,`orders/${t}`));if(a.exists()){const n=a.val(),s=document.createElement('div');s.className='glass-card',s.style.marginBottom='1rem',s.innerHTML=`<p><strong>${n.productSnapshot.title}</strong></p><p>Price: ₹${n.productSnapshot.price}</p><p>Date: ${new Date(n.createdAt).toLocaleDateString()}</p>`,e.appendChild(s)}}}
        async function loadUserProfile(){if(!currentUser)return;const e=ref(db,`users/${currentUser.uid}/profile`),t=await get(e);if(t.exists()){const e=t.val();document.getElementById('profile-image-preview').style.backgroundImage=`url(${e.imageUrl||""})`,document.getElementById('profile-image-url').value=e.imageUrl||"",document.getElementById('profile-name').value=e.name||"",document.getElementById('profile-dob').value=e.dob||"",document.getElementById('profile-address').value=e.address||"",document.getElementById('profile-phone').value=e.phone||""}}
        async function handleProfileSave(e){e.preventDefault();if(!currentUser)return;const t={imageUrl:document.getElementById('profile-image-url').value,name:document.getElementById('profile-name').value,dob:document.getElementById('profile-dob').value,address:document.getElementById('profile-address').value,phone:document.getElementById('profile-phone').value},a=ref(db,`users/${currentUser.uid}/profile`);try{await set(a,t),alert('Profile updated!'),document.getElementById('profile-image-preview').style.backgroundImage=`url(${t.imageUrl||""})`,updateMenu()}catch(e){alert('Error: '+e.message)}}
        function openAuthModal(){authMode='login',updateAuthModalUI(),openModal('auth-modal')}
        function setAuthMode(e){authMode=e,updateAuthModalUI()}
        function updateAuthModalUI(){const e=document.getElementById('auth-title'),t=document.getElementById('auth-action-btn'),a=document.getElementById('auth-links'),n=document.getElementById('auth-confirm-password-group'),s=document.getElementById('auth-password-group'),i=document.getElementById('auth-error'),d=document.getElementById('auth-message');i.textContent='',d.classList.add('hidden'),document.getElementById('auth-form').reset(),"login"===authMode?(e.textContent='Login',t.textContent='Login',s.classList.remove('hidden'),n.classList.add('hidden'),a.innerHTML='<a id="auth-forgot-link">Forgot Password?</a>|<a id="auth-signup-link">Need an account?</a>',document.getElementById('auth-forgot-link').addEventListener('click',()=>setAuthMode('forgot')),document.getElementById('auth-signup-link').addEventListener('click',()=>setAuthMode('signup'))):"signup"===authMode?(e.textContent='Create Account',t.textContent='Sign Up',s.classList.remove('hidden'),n.classList.remove('hidden'),a.innerHTML='<a id="auth-login-link">Have an account? Login</a>',document.getElementById('auth-login-link').addEventListener('click',()=>setAuthMode('login'))):"forgot"===authMode&&(e.textContent='Reset Password',t.textContent='Send Reset Link',s.classList.add('hidden'),n.classList.add('hidden'),a.innerHTML='<a id="auth-back-login-link">Back to Login</a>',document.getElementById('auth-back-login-link').addEventListener('click',()=>setAuthMode('login')))}
        async function handleAuthAction(e){e.preventDefault();const t=document.getElementById('auth-email').value,a=document.getElementById('auth-password').value,n=document.getElementById('auth-error'),s=document.getElementById('auth-message');n.textContent='',s.classList.add('hidden');try{"login"===authMode?await signInWithEmailAndPassword(auth,t,a):"signup"===authMode?a!==document.getElementById('auth-confirm-password').value?n.textContent="Passwords do not match.":await createUserWithEmailAndPassword(auth,t,a):"forgot"===authMode&&(await sendPasswordResetEmail(auth,t),s.textContent='Password reset email sent!',s.classList.remove('hidden'))}catch(e){return void(n.textContent=e.message)}closeModal()}
        const policies={refund:{title:'Refund Policy',content:'- All sales final.\n- Refunds for defective products only (within 7 days).'},terms:{title:'T&C',content:'- By using our service, you agree to these terms.\n- Service is provided "as is".'},delivery:{title:'Delivery',content:'- Digital products are delivered instantly.\n- Physical products ship in 2-3 business days.'},privacy:{title:'Privacy',content:'- We collect data for order processing only.\n- We do not share your data.'}};
        function openPolicyModal(e){const t=policies[e];t&&(document.getElementById('policy-title').textContent=t.title,document.getElementById('policy-content').textContent=t.content,openModal('policy-modal'))}
    </script>
</body>
</html>
